//// globals
// api endpoint
//// utilities
// debounces given function by given delay
//// Views
// renders the separator element between autocomplete suggestions
// renders individual autocomplete options (usernames)
// renders full autocomplete element
// params: text input field element
//         text input field's parent element
//         autocomplete data (array from IG API response)
// removes autocomplete element
//// event handlers
function debounce(e,t){var n=null
return function(){var r=this,o=arguments
clearTimeout(n),n=setTimeout(function(){e.apply(r,o)},t)}}function renderSeparator(){var e=document.createElement("span")
return e.innerHTML="|",e.style.paddingLeft="4px",e.style.paddingRight="4px",e}function renderAutocompleteOption(e,t){var n=document.createElement("span")
return n.className="autocomplete-option",n.id=t,n.innerHTML="@"+e,n.style.color="#003569",n.style.cursor="pointer",n.addEventListener("click",function(){handleSelectedOption(n.id)}),n}function renderAutocomplete(e,t,n){var r=document.createElement("div")
r.className="autocomplete-picker",r.style.display="inline-block"
for(var o=0;o<n.length;o++)r.appendChild(renderAutocompleteOption(n[o].user.username,o)),o<n.length-1&&r.appendChild(renderSeparator())
t.appendChild(r)}function destructAutocomplete(){var e=document.getElementsByClassName("autocomplete-picker")
e[0]&&e[0].remove()}function handleSelectedOption(e){inputAsArray[typingLocation]="@"+autocompletes[e].user.username,inputField.value=inputAsArray.join(" "),inputField.append(" ")}function handleResponse(e,t){if(void 0!==e.users[0]){destructAutocomplete()
var n=t.parentNode
autocompletes=e.users.slice(0,3),renderAutocomplete(t,n,autocompletes)}}var searchURLParts=["https://www.instagram.com/web/search/topsearch/?context=blended&query=","&rank_token="],inputField=null,inputAsArray=[],autocompletes=[],typingLocation=0,body=document.querySelector("body"),pendingRequest=null
body.addEventListener("keyup",function(e){if(e.target!==e.currentTarget&&"Add a commentâ€¦"===e.target.placeholder){inputField=e.target
inputAsArray=inputField.value.split(" ")
var t=inputAsArray[inputAsArray.length-1]
if(void 0!==t&&"@"===t.charAt(0)){typingLocation=inputAsArray.length-1,t=t.substring(1)
var n=searchURLParts[0]+t+searchURLParts[1]+"0.500",r=new XMLHttpRequest
r.onload=function(e){handleResponse(e.target.response,inputField),pendingRequest=null},r.open("GET",n),r.responseType="json",pendingRequest&&pendingRequest.abort(),r.send(),pendingRequest=r}else destructAutocomplete()}e.stopPropagation()})
